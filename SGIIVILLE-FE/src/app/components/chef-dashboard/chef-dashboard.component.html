<div class="chef-container">

  <!-- Sidebar Menu pour Actions Rapides -->
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
    <button class="sidebar-toggle" (click)="toggleSidebar()">
      {{ sidebarCollapsed ? 'â˜°' : 'âœ•' }}
    </button>

    <div class="sidebar-content" *ngIf="!sidebarCollapsed">
      <h3 ></h3>

      <nav class="sidebar-nav">
        <button class="sidebar-item" (click)="refreshAll()">
          <span class="sidebar-icon">â†»</span>
          <span class="sidebar-label">Actualiser</span>
        </button>

        <button class="sidebar-item" (click)="openMapModal()">
          <span class="sidebar-icon">ğŸ“</span>
          <span class="sidebar-label">Carte demandes</span>
          <span class="sidebar-badge">{{ demandesPendantes }}</span>
        </button>

        <button class="sidebar-item" (click)="openMapInterventionsModal()">
          <span class="sidebar-icon">ğŸŒ</span>
          <span class="sidebar-label">Carte interventions</span>
          <span class="sidebar-badge">{{ interventionsEnCoursCount }}</span>
        </button>

        <button class="sidebar-item" (click)="openTechniciensModal()">
          <span class="sidebar-icon">ğŸ‘¤</span>
          <span class="sidebar-label">Techniciens</span>
          <span class="sidebar-badge">{{ techniciens.length }}</span>
        </button>

        <button class="sidebar-item" (click)="openEquipementsModal()">
          <span class="sidebar-icon">âš™ï¸</span>
          <span class="sidebar-label">Ã‰quipements</span>
          <span class="sidebar-badge">{{ equipements.length }}</span>
        </button>

        <button class="sidebar-item" (click)="openInterventionsModal()">
          <span class="sidebar-icon">âš¡</span>
          <span class="sidebar-label">Interventions</span>
          <span class="sidebar-badge">{{ interventions.length }}</span>
        </button>

        <button class="sidebar-item" (click)="openRessourcesModal()">
          <span class="sidebar-icon">ğŸ“Š</span>
          <span class="sidebar-label">MatÃ©riels</span>
        </button>

        <button class="sidebar-item" (click)="exportReport()">
          <span class="sidebar-icon">â¬‡ï¸</span>
          <span class="sidebar-label">Exporter</span>
        </button>
      </nav>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="main-content" [class.sidebar-open]="sidebarCollapsed">
    <!-- Header Moderne -->
    <header class="header">
      <div class="header-content">
        <h1>ğŸ¯ Espace Chef de Service</h1>
        <p class="subtitle">Gestion intelligente des interventions urbaines â€¢ Tunis 2025</p>
      </div>

    <!-- IcÃ´ne notifications -->
    <div class="notification-bell" (click)="toggleNotificationsDropdown()">
      ğŸ””
      <span class="badge" *ngIf="unreadCount > 0">{{ unreadCount }}</span>

      <!-- Dropdown notifications -->
      <div class="notifications-dropdown" *ngIf="showNotificationsDropdown" (click)="$event.stopPropagation()">
        <div class="dropdown-header">
          <h4>Notifications</h4>
          <span class="count">{{ unreadCount }} non lue(s)</span>
        </div>
        <div class="notifications-list">
          <div *ngIf="notifications.length === 0" class="empty-state">
            Aucune notification
          </div>
          <div *ngFor="let notif of notifications"
               class="notification-item"
               [class.unread]="!notif.readable"
               (click)="markAsRead(notif)">
            <div class="notif-icon">
              {{ notif.readable ? 'ğŸ“¬' : 'ğŸ“­' }}
            </div>
            <div class="notif-content">
              <p class="notif-message">{{ notif.message }}</p>
              <span class="notif-time">{{ formatNotificationDate(notif.createdAt) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Stats Cards Modernes -->
  <div class="stats-grid">
    <div class="stat-card pending" (click)="filtrerDemandes('NON_TRAITEES')">
      <div class="icon">â³</div>
      <div class="info">
        <h3>{{ demandesPendantes }}</h3>
        <p>Demandes en attente</p>
      </div>
    </div>
    <div class="stat-card progress" (click)="openInterventionsModal()">
      <div class="icon">ğŸ”§</div>
      <div class="info">
        <h3>{{ interventionsEnCoursCount }}</h3>
        <p>Interventions en cours</p>
      </div>
    </div>
    <div class="stat-card success" (click)="filtrerDemandes('TRAITEES')">
      <div class="icon">âœ…</div>
      <div class="info">
        <h3>{{ demandesTraitees }}</h3>
        <p>Demandes traitÃ©es</p>
      </div>
    </div>
    <div class="stat-card equip" (click)="openEquipementsModal()">
      <div class="icon">ğŸ› ï¸</div>
      <div class="info">
        <h3>{{ equipements.length }}</h3>
        <p>Ã‰quipements disponibles</p>
      </div>
    </div>
  </div>

    <!-- Section Filtres ModernisÃ©e -->
    <div class="filters-section">
      <h3>ğŸ“Š Filtrer les demandes</h3>
      <div class="filter-buttons">
        <button [class.active]="filtreActif === 'TOUS'" (click)="filtrerDemandes('TOUS')" class="filter-btn">
          ğŸ“‹ Toutes ({{ demandes.length }})
        </button>
        <button [class.active]="filtreActif === 'NON_TRAITEES'" (click)="filtrerDemandes('NON_TRAITEES')" class="filter-btn">
          â³ Non traitÃ©es ({{ demandesPendantes }})
        </button>
        <button [class.active]="filtreActif === 'TRAITEES'" (click)="filtrerDemandes('TRAITEES')" class="filter-btn">
          âœ… TraitÃ©es ({{ demandesTraitees }})
        </button>
      </div>
    </div>

      <!-- Tableau des Demandes ModernisÃ© -->
    <section class="section">
      <h3>ğŸ“‹ Demandes citoyennes <span style="color: #667eea; font-weight: 700;">({{ demandesFiltrees.length }})</span></h3>
      <div class="table-container">
      <table class="modern-table">
        <thead>
          <tr>
            <th>ğŸ“Œ RÃ©fÃ©rence</th>
            <th>ğŸ“ Description</th>
            <th>ğŸ“… Date</th>
            <th>ğŸ·ï¸ Statut</th>
            <th>ğŸ“ Localisation</th>
            <th>ğŸ“¸ Photos</th>
            <th>âš™ï¸ Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let d of demandesFiltrees">
            <td><strong style="color: #667eea;">#{{ d.id }}</strong></td>
            <td class="description-cell">
              {{ d.description.length > 60 ? (d.description | slice:0:60) + '...' : d.description }}
            </td>
            <td>{{ d.dateSoumission | date:'dd/MM/yyyy' }}</td>
            <td>
              <span class="status" [ngClass]="getEtatBadgeClass(d.etat)">
                {{ getEtatText(d.etat) }}
              </span>
            </td>
            <td class="location-cell">
              <span *ngIf="d.localisation" style="font-size: 12px;">
                ğŸ“ {{ d.localisation.latitude | number:'1.4' }}, {{ d.localisation.longitude | number:'1.4' }}
              </span>
              <span *ngIf="!d.localisation" class="text-muted">Non prÃ©cisÃ©e</span>
            </td>
            <td style="text-align: center;">
              <span *ngIf="d.photos?.length"
                    style="background: #e3f2fd; color: #2196f3; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                {{ d.photos?.length }} ğŸ“¸
              </span>
              <span *ngIf="!d.photos?.length" class="text-muted" style="font-size: 12px;">Aucune</span>
            </td>
            <td class="actions-cell">
              <button class="btn-small view" (click)="openDetailModal(d)">ğŸ‘ï¸ DÃ©tails</button>
              <button class="btn-small plan" (click)="planifierDemande(d)"
                      [disabled]="d.etat === 'TRAITEE'">
                {{ d.etat === 'TRAITEE' ? 'âœ… PlanifiÃ©e' : 'ğŸ“… Planifier' }}
              </button>
            </td>
          </tr>
          <tr *ngIf="!demandesFiltrees.length">
            <td colspan="7" class="no-data">
              <div style="padding: 20px;">
                <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“­</div>
                <p>Aucune demande Ã  afficher</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    </section>
  </div><!-- Fin main-content -->

  <!-- MODAL TECHNICIENS -->
  <div class="modal-overlay" *ngIf="showTechniciensModal" (click)="closeModal()">
    <div class="modal-content techniciens-modal" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeModal()">Ã—</button>
      <h2>ğŸ‘· Liste des Techniciens</h2>
      <p class="subtitle">Total : {{ techniciens.length }} technicien(s) disponible(s)</p>

      <div class="techniciens-grid">
        <div class="technicien-card" *ngFor="let tech of techniciens">
          <div class="tech-header">
            <h4>{{ tech.nom }}</h4>
            <span class="status"
                  [ngClass]="tech.disponibilite ? 'done' : 'error'"
                  [style.text-transform]="'uppercase'">
              {{ tech.disponibilite ? 'âœ… DISPONIBLE' : 'âŒ OCCUPÃ‰' }}
            </span>
          </div>
          <div class="equip-details">
            <p>ğŸ“§ <strong>Email :</strong> {{ tech.email }}</p>
            <p><strong>ğŸ¯ CompÃ©tences :</strong></p>
            <div class="competences-list" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
              <span class="priority basse"
                    *ngFor="let c of tech.competences"
                    style="display: inline-block;">
                {{ c }}
              </span>
              <span class="text-muted" *ngIf="!tech.competences?.length">Aucune compÃ©tence</span>
            </div>
          </div>
        </div>
        <div class="no-data" *ngIf="!techniciens.length">
          <div style="font-size: 48px;">ğŸ‘·</div>
          <p>Aucun technicien trouvÃ©</p>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL PLANIFICATION AVEC NOUVEAU COMPOSANT -->
  <div class="modal-overlay" *ngIf="showPlanificationModal && selectedDemande" (click)="closePlanificationModal()">
    <div class="modal-content planification-modal" (click)="$event.stopPropagation()" style="max-width: 1200px; max-height: 95vh; overflow-y: auto;">
      <button class="close-btn" (click)="closePlanificationModal()">Ã—</button>
      
      <app-intervention-planification
        [demandeId]="selectedDemande.id"
        (planificationComplete)="onPlanificationComplete($event)"
        (cancelled)="closePlanificationModal()">
      </app-intervention-planification>
    </div>
  </div>

  <!-- ANCIEN MODAL PLANIFICATION (Ã  supprimer plus tard) -->
  <div class="modal-overlay" *ngIf="false" (click)="closePlanificationModal()">
    <div class="modal-content planification-modal" (click)="$event.stopPropagation()" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <button class="close-btn" (click)="closePlanificationModal()">Ã—</button>
      <h2>ğŸ“… Planifier l'Intervention - Demande #{{selectedDemande?.id}}</h2>

      <form>
        <!-- SÃ©lection Technicien -->
        <div class="form-section">
          <label><strong>ğŸ‘· Technicien *</strong></label>
          <select [(ngModel)]="planificationData.technicienId" name="technicienId" required>
            <option value="">-- SÃ©lectionner un technicien --</option>
            <option *ngFor="let tech of techniciensDisponibles" [value]="tech.id">
              {{tech.nom}} - {{tech.email}}
              <span *ngIf="tech.competences?.length">({{tech.competences.join(', ')}})</span>
            </option>
          </select>
        </div>

        <!-- Date et Heure -->
        <div class="form-grid">
          <div class="form-section">
            <label><strong>ğŸ“… Date prÃ©vue *</strong></label>
            <input type="date" [(ngModel)]="planificationData.datePlanifiee" name="datePlanifiee" required>
          </div>
          <div class="form-section">
            <label><strong>ğŸ• Heure dÃ©but</strong></label>
            <input type="time" [(ngModel)]="planificationData.heureDebut" name="heureDebut">
          </div>
          <div class="form-section">
            <label><strong>ğŸ• Heure fin</strong></label>
            <input type="time" [(ngModel)]="planificationData.heureFin" name="heureFin">
          </div>
          <div class="form-section">
            <label><strong>â±ï¸ DurÃ©e (minutes)</strong></label>
            <input type="number" [(ngModel)]="planificationData.dureeMinutes" name="dureeMinutes" min="15" step="15">
          </div>
        </div>

        <!-- PrioritÃ© et Budget -->
        <div class="form-grid">
          <div class="form-section">
            <label><strong>âš¡ PrioritÃ© *</strong></label>
            <select [(ngModel)]="planificationData.priorite" name="priorite" required>
              <option value="NORMALE">ğŸŸ¢ Normale</option>
              <option value="URGENTE">ğŸŸ¡ Urgente</option>
              <option value="CRITIQUE">ğŸ”´ Critique</option>
              <option value="PLANIFIEE">ğŸ“… PlanifiÃ©e</option>
            </select>
          </div>
          <div class="form-section">
            <label><strong>ğŸ’° Budget (DT) *</strong></label>
            <input type="number" [(ngModel)]="planificationData.budget" name="budget" min="0" step="0.01" required>
          </div>
        </div>

        <!-- Type et Description -->
        <div class="form-section">
          <label><strong>ğŸ·ï¸ Type d'intervention</strong></label>
          <input type="text" [(ngModel)]="planificationData.typeIntervention" name="typeIntervention"
                 placeholder="Ex: Ã‰clairage, Eau, Route...">
        </div>

        <div class="form-section">
          <label><strong>ğŸ“ Description</strong></label>
          <textarea [(ngModel)]="planificationData.description" name="description" rows="3"
                    placeholder="Description de l'intervention..."></textarea>
        </div>

        <!-- Ã‰quipements -->
        <div class="form-section">
          <label><strong>ğŸ› ï¸ Ã‰quipements nÃ©cessaires</strong></label>
          <div class="checkbox-list">
            <label *ngFor="let eq of equipements" class="checkbox-item">
              <input type="checkbox"
                     [checked]="planificationData.equipementIds.includes(eq.id)"
                     (change)="toggleEquipement(eq.id)">
              <span>{{eq.type}} - {{eq.etat}}</span>
            </label>
            <p *ngIf="equipements.length === 0" class="text-muted">Aucun Ã©quipement disponible</p>
          </div>
        </div>

        <!-- Ressources -->
        <div class="form-section">
          <label><strong>ğŸ“¦ Ressources matÃ©rielles</strong></label>
          <div class="checkbox-list">
            <label *ngFor="let res of ressources" class="checkbox-item">
              <input type="checkbox"
                     [checked]="planificationData.ressourceIds.includes(res.id)"
                     (change)="toggleRessource(res.id)">
              <span>{{res.designation}} (Stock: {{res.quantiteEnStock}})</span>
            </label>
            <p *ngIf="ressources.length === 0" class="text-muted">Aucune ressource disponible</p>
          </div>
        </div>

        <!-- Remarques -->
        <div class="form-section">
          <label><strong>ğŸ’¬ Remarques / Instructions</strong></label>
          <textarea [(ngModel)]="planificationData.remarques" name="remarques" rows="3"
                    placeholder="Instructions spÃ©ciales, remarques..."></textarea>
        </div>

        <!-- Actions -->
        <div class="form-actions">
          <button type="button" class="action-btn secondary" (click)="closePlanificationModal()">Annuler</button>
          <button type="button" class="action-btn primary large" (click)="validerPlanification()">âœ… Valider la Planification</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL DÃ‰TAILS DEMANDE -->
  <div class="modal-overlay" *ngIf="showDetailModal && selectedDemande" (click)="closeDetailModal()">
    <div class="modal-content detail-modal" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeDetailModal()">Ã—</button>
      <div class="detail-header">
        <h2>ğŸ“‹ DÃ©tail de la demande #{{ selectedDemande.id }}</h2>
        <span class="status" [ngClass]="getEtatBadgeClass(selectedDemande.etat)">
          {{ getEtatText(selectedDemande.etat) }}
        </span>
      </div>
      <div class="detail-grid">
        <div class="detail-left">
          <div class="info-block">
            <h3>ğŸ“ Description complÃ¨te</h3>
            <p class="description">{{ selectedDemande.description }}</p>
          </div>
          <div class="info-block">
            <h3>ğŸ“… Date de soumission</h3>
            <p>{{ selectedDemande.dateSoumission | date:'fullDate' }}</p>
          </div>
          <div class="info-block">
            <h3>ğŸ“ Localisation GPS</h3>
            <ng-container *ngIf="selectedDemande.localisation as loc; else noLocation">
              <p><strong>Lat:</strong> {{ loc.latitude | number:'1.6' }}<br>
                 <strong>Lng:</strong> {{ loc.longitude | number:'1.6' }}</p>
              <a [href]="'https://www.google.com/maps?q=' + loc.latitude + ',' + loc.longitude" target="_blank" class="map-link">
                Voir sur Google Maps
              </a>
            </ng-container>
            <ng-template #noLocation><p class="text-muted">Localisation non fournie</p></ng-template>
          </div>
          <div class="action-buttons" *ngIf="selectedDemande.etat !== 'TRAITEE'">
            <button class="action-btn primary large" (click)="planifierDemande(selectedDemande)">
              Planifier l'intervention
            </button>
          </div>
        </div>
        <div class="detail-right">
          <h3>Photos jointes ({{ selectedDemande.photos?.length || 0 }})</h3>
          <div class="photos-grid" *ngIf="selectedDemande.photos?.length; else noPhotos">
            <div class="photo-item" *ngFor="let photo of selectedDemande.photos">
              <div class="photo-container">
                <img [src]="getPhotoUrl(photo.url)" [alt]="photo.nom" (error)="handleImageError($event)" class="demande-photo">
                <div class="photo-overlay">
                  <button class="view-photo-btn" (click)="openPhotoModal(getPhotoUrl(photo.url))">Agrandir</button>
                </div>
              </div>
              <p class="photo-caption">{{ photo.nom || 'Photo' }}</p>
            </div>
          </div>
          <ng-template #noPhotos>
            <div class="no-photos-message"><div class="no-photos-icon">Photo</div><p>Aucune photo</p></div>
          </ng-template>
        </div>
      </div>
      <div class="detail-actions">
        <button class="action-btn secondary" (click)="closeDetailModal()">Fermer</button>
      </div>
    </div>
  </div>

  <!-- MODAL INTERVENTIONS -->
  <div class="modal-overlay" *ngIf="showInterventionModal" (click)="closeModal()">
    <div class="modal-content interventions-modal" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeModal()">Ã—</button>
      <h2>Liste des Interventions</h2>
      <div class="interventions-list">
        <div class="intervention-card" *ngFor="let i of interventions">
          <div class="intervention-header">
            <h4>Intervention #{{ i.id }}</h4>
            <span [ngClass]="getEtatBadgeClass(i.etat)">{{ i.etat }}</span>
          </div>
          <div class="intervention-details">
            <p><strong>PrioritÃ©:</strong> {{ i.priorite }}</p>
            <p><strong>Date:</strong> {{ i.datePlanifiee | date:'dd/MM/yyyy' }}</p>
            <p><strong>Budget:</strong> {{ i.budget | currency:'EUR' }}</p>
            <p *ngIf="i.technicienId"><strong>Technicien:</strong> #{{ i.technicienId }}</p>
          </div>
        </div>
        <div *ngIf="!interventions.length" class="no-data">Aucune intervention planifiÃ©e</div>
      </div>
    </div>
  </div>

<!-- MODAL LISTE Ã‰QUIPEMENTS -->
<div class="modal-overlay" *ngIf="showEquipementModal" (click)="closeModal()">
  <div class="modal-content equipements-modal" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeModal()">Ã—</button>
    <h2>ğŸ› ï¸ Gestion des Ã‰quipements</h2>

    <div class="modal-actions">
      <button class="action-btn success" (click)="openAddEquipement()">
        â• Nouvel Ã©quipement
      </button>
    </div>

    <div class="table-container">
      <table class="modern-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nom</th>
            <th>Type</th>
            <th>Ã‰tat</th>
            <th>Valeur</th>
            <th>Disponible</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let e of equipements">
            <td><strong>#{{ e.id }}</strong></td>
            <td>{{ e.nom }}</td>
            <td>{{ e.type }}</td>
            <td>
              <span class="status" [ngClass]="getEtatBadgeClass(e.etat)">
                {{ getEtatText(e.etat) }}
              </span>
            </td>
            <td>{{ e.valeurAchat | currency:'EUR' }}</td>
            <td>
              <span class="status" [ngClass]="e.disponible ? 'done' : 'error'">
                {{ e.disponible ? 'âœ… Oui' : 'âŒ Non' }}
              </span>
            </td>
            <td class="actions-cell">
              <button class="btn-small edit" (click)="editEquipement(e)">âœï¸ Modifier</button>
              <button class="btn-small delete" (click)="deleteEquipement(e.id)">ğŸ—‘ï¸ Supprimer</button>
            </td>
          </tr>
          <tr *ngIf="!equipements.length">
            <td colspan="7" class="no-data">
              <div style="padding: 20px;">
                <div style="font-size: 48px; margin-bottom: 10px;">ğŸ› ï¸</div>
                <p>Aucun Ã©quipement enregistrÃ©</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- MODAL LISTE RESSOURCES -->
<div class="modal-overlay" *ngIf="showRessourceModal" (click)="closeModal()">
  <div class="modal-content ressources-modal" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeModal()">Ã—</button>
    <h2>ğŸ“¦ Gestion des MatÃ©riels</h2>

    <div class="modal-actions">
      <button class="action-btn success" (click)="openAddRessource()">
        â• Nouveau matÃ©riel
      </button>
    </div>

    <div class="table-container">
      <table class="modern-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>DÃ©signation</th>
            <th>QuantitÃ©</th>
            <th>Valeur</th>
            <th>Fournisseur</th>
            <th>UnitÃ©</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of ressources">
            <td><strong>#{{ r.id }}</strong></td>
            <td>{{ r.designation }}</td>
            <td>
              <span [class]="r.quantiteEnStock > 0 ? 'status done' : 'status error'">
                {{ r.quantiteEnStock }}
              </span>
            </td>
            <td>{{ r.valeurAchat | currency:'EUR' }}</td>
            <td>{{ r.fournisseurId ? '#' + r.fournisseurId : 'N/A' }}</td>
            <td>{{ r.unite || 'N/A' }}</td>
            <td class="actions-cell">
              <button class="btn-small edit" (click)="editRessource(r)">âœï¸ Modifier</button>
              <button class="btn-small delete" (click)="deleteRessource(r.id)">ğŸ—‘ï¸ Supprimer</button>
            </td>
          </tr>
          <tr *ngIf="!ressources.length">
            <td colspan="7" class="no-data">
              <div style="padding: 20px;">
                <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“¦</div>
                <p>Aucun matÃ©riel enregistrÃ©</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- MODAL FORMULAIRE Ã‰QUIPEMENT -->
<div class="modal-overlay" *ngIf="showEquipementFormModal" (click)="closeEquipementForm()">
  <div class="modal-content form-modal" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeEquipementForm()">Ã—</button>
    <h2>{{ editingEquipement ? 'Modifier' : 'Ajouter' }} un Ã©quipement</h2>

    <form (ngSubmit)="saveEquipement()" class="equipement-form">
      <div class="form-group">
        <label>Nom de l'Ã©quipement *</label>
        <input [(ngModel)]="currentEquipement.nom" name="nom" placeholder="Ex: Camion-benne..." required>
      </div>

      <div class="form-group">
        <label>Type d'Ã©quipement *</label>
        <input [(ngModel)]="currentEquipement.type" name="type" placeholder="Ex: VÃ©hicule, Outil..." required>
      </div>

      <div class="form-group">
        <label>Ã‰tat *</label>
        <select [(ngModel)]="currentEquipement.etat" name="etat" required>
          <option value="FONCTIONNEL">Fonctionnel</option>
          <option value="DEFECTUEUX">DÃ©fectueux</option>
          <option value="EN_MAINTENANCE">En maintenance</option>
        </select>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label>ID Fournisseur</label>
          <input type="number" [(ngModel)]="currentEquipement.fournisseurId" name="fournisseurId" min="0" placeholder="Optionnel">
        </div>

        <div class="form-group">
          <label>Valeur d'achat (DT)</label>
          <input type="number" [(ngModel)]="currentEquipement.valeurAchat" name="valeurAchat" step="0.01" min="0" placeholder="0.00">
        </div>
      </div>

      <div class="form-group">
        <label>Date d'achat</label>
        <input type="date" [(ngModel)]="currentEquipement.dateAchat" name="dateAchat">
      </div>

      <div class="form-actions">
        <button type="button" class="action-btn secondary" (click)="closeEquipementForm()">Annuler</button>
        <button type="submit" class="action-btn primary">
          {{ editingEquipement ? 'Modifier' : 'Ajouter' }} l'Ã©quipement
        </button>
      </div>
    </form>
  </div>
</div>

<!-- MODAL FORMULAIRE RESSOURCE -->
<div class="modal-overlay" *ngIf="showRessourceFormModal" (click)="closeRessourceForm()">
  <div class="modal-content form-modal" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeRessourceForm()">Ã—</button>
    <h2>{{ editingRessource ? 'Modifier' : 'Ajouter' }} un matÃ©riel</h2>

    <form (ngSubmit)="saveRessource()" class="ressource-form">
      <div class="form-group">
        <label>DÃ©signation *</label>
        <input [(ngModel)]="currentRessource.designation" name="designation" placeholder="Ex: Ciment, Tuyaux..." required>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label>QuantitÃ© en stock *</label>
          <input type="number" [(ngModel)]="currentRessource.quantiteEnStock" name="quantiteEnStock" min="0" required>
        </div>

        <div class="form-group">
          <label>Valeur d'achat (DT) *</label>
          <input type="number" [(ngModel)]="currentRessource.valeurAchat" name="valeurAchat" step="0.01" min="0" required>
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label>ID Fournisseur</label>
          <input type="number" [(ngModel)]="currentRessource.fournisseurId" name="fournisseurId" min="0" placeholder="Optionnel">
        </div>

        <div class="form-group">
          <label>UnitÃ©</label>
          <input [(ngModel)]="currentRessource.unite" name="unite" placeholder="Ex: kg, m, L...">
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="action-btn secondary" (click)="closeRessourceForm()">Annuler</button>
        <button type="submit" class="action-btn primary">
          {{ editingRessource ? 'Modifier' : 'Ajouter' }} le matÃ©riel
        </button>
      </div>
    </form>
  </div>
</div>

  <!-- MODAL CARTE DES DEMANDES -->
  <div class="modal-overlay" *ngIf="showMapModal" (click)="closeMapModal()">
    <div class="modal-content map-modal" (click)="$event.stopPropagation()" style="max-width: 1200px; width: 95%; height: 85vh;">
      <button class="close-btn" (click)="closeMapModal()">Ã—</button>
      <h2>ğŸ—ºï¸ Carte des demandes non traitÃ©es</h2>

      <!-- LÃ©gende -->
      <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; gap: 20px; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div style="display: flex; align-items: center; gap: 8px;">
          <div style="width: 20px; height: 20px; border-radius: 50%; background: #f44336; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
          <span style="font-weight: 600; color: #333;">ğŸ”´ Urgent</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <div style="width: 20px; height: 20px; border-radius: 50%; background: #FFC107; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
          <span style="font-weight: 600; color: #333;">ğŸŸ¡ Moyen</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <div style="width: 20px; height: 20px; border-radius: 50%; background: #4CAF50; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
          <span style="font-weight: 600; color: #333;">ğŸŸ¢ Bas</span>
        </div>
        <div style="margin-left: 20px; color: #667eea; font-weight: 700;">
          Total: {{ demandesNonTraitees.length }} demande(s)
        </div>
      </div>

      <!-- Carte Leaflet -->
      <div id="mapChef" style="height: calc(100% - 120px); border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"></div>
    </div>
  </div>

  <!-- MODAL CARTE DES INTERVENTIONS -->
  <div class="modal-overlay" *ngIf="showMapInterventionsModal" (click)="closeMapInterventionsModal()">
    <div class="modal-content map-modal" (click)="$event.stopPropagation()" style="max-width: 1200px; width: 95%; height: 85vh;">
      <button class="close-btn" (click)="closeMapInterventionsModal()">Ã—</button>
      <h2>ğŸ—ºï¸ Carte des interventions en cours</h2>

      <!-- LÃ©gende -->
      <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; gap: 20px; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div style="display: flex; align-items: center; gap: 8px;">
          <div style="width: 20px; height: 20px; border-radius: 50%; background: #2196F3; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
          <span style="font-weight: 600; color: #333;">ğŸ”µ En cours</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <div style="width: 20px; height: 20px; border-radius: 50%; background: #FF9800; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
          <span style="font-weight: 600; color: #333;">ğŸŸ  En attente</span>
        </div>
        <div style="margin-left: 20px; color: #667eea; font-weight: 700;">
          Total: {{ interventionsEnCours.length }} intervention(s)
        </div>
      </div>

      <!-- Carte Leaflet -->
      <div id="mapInterventions" style="height: calc(100% - 120px); border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"></div>
    </div>
  </div>

</div>
