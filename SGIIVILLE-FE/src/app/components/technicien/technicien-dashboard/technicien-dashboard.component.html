<!-- ============================================
     DASHBOARD TECHNICIEN - DESIGN HARMONISÃ‰
     ============================================ -->

<div class="technicien-dashboard">
  <!-- PAGE HEADER -->
  <header class="overview-header">
    <div class="header-content">
      <h1>ğŸ”§ Tableau de Bord Technicien</h1>
      <p class="subtitle">Gestion intelligente de vos interventions â€¢ Tunis 2025</p>
    </div>
    <div class="header-actions">
      <button
        class="btn-view-toggle"
        (click)="toggleView()"
        [attr.aria-label]="'Basculer entre vue liste et calendrier'">
        <span *ngIf="viewMode === 'list'">ğŸ“… Vue Calendrier</span>
        <span *ngIf="viewMode === 'calendar'">ğŸ“‹ Vue Liste</span>
      </button>
      <button
        class="btn-refresh"
        (click)="actualiser()"
        [attr.aria-label]="'Actualiser'">
        <span class="icon">â†»</span>
        Actualiser
      </button>
    </div>
  </header>

  <!-- KPI CARDS -->
  <div class="kpi-grid">
    <div class="kpi-card" [style.border-left]="'4px solid #FFC107'" [routerLink]="['/technicien/interventions']" [class.clickable]="true">
      <div class="kpi-icon" [style.background]="'#FFC10720'">
        <span [style.color]="'#FFC107'">â³</span>
      </div>
      <div class="kpi-content">
        <h3 class="kpi-value">{{ stats.enAttente }}</h3>
        <p class="kpi-title">En Attente</p>
      </div>
    </div>

    <div class="kpi-card" [style.border-left]="'4px solid #3b82f6'" [routerLink]="['/technicien/interventions/en-cours']" [class.clickable]="true">
      <div class="kpi-icon" [style.background]="'#3b82f620'">
        <span [style.color]="'#3b82f6'">ğŸ”§</span>
      </div>
      <div class="kpi-content">
        <h3 class="kpi-value">{{ stats.enCours }}</h3>
        <p class="kpi-title">En Cours</p>
      </div>
    </div>

    <div class="kpi-card" [style.border-left]="'4px solid #4CAF50'" [routerLink]="['/technicien/rapports-finaux']" [class.clickable]="true">
      <div class="kpi-icon" [style.background]="'#4CAF5020'">
        <span [style.color]="'#4CAF50'">âœ…</span>
      </div>
      <div class="kpi-content">
        <h3 class="kpi-value">{{ stats.terminees }}</h3>
        <p class="kpi-title">TerminÃ©es</p>
      </div>
    </div>

    <div class="kpi-card" [style.border-left]="'4px solid #9E9E9E'" *ngIf="stats.suspendues > 0">
      <div class="kpi-icon" [style.background]="'#9E9E9E20'">
        <span [style.color]="'#9E9E9E'">â¸ï¸</span>
      </div>
      <div class="kpi-content">
        <h3 class="kpi-value">{{ stats.suspendues }}</h3>
        <p class="kpi-title">Suspendues</p>
      </div>
    </div>
  </div>

  <!-- VUE CALENDRIER -->
  <div *ngIf="viewMode === 'calendar'" class="calendar-section">
    <app-mini-calendar
      [interventions]="interventions"
      [selectedDate]="selectedCalendarDate"
      (dateSelected)="onDateSelected($event)"
      (interventionClicked)="onInterventionClicked($event)">
    </app-mini-calendar>

    <!-- INTERVENTIONS DU JOUR SÃ‰LECTIONNÃ‰ -->
    <div *ngIf="selectedCalendarDate" class="selected-date-interventions">
      <h3>Interventions du {{ selectedCalendarDate | date:'dd/MM/yyyy' }}</h3>
      <div class="interventions-list-compact">
        <div
          *ngFor="let intervention of interventionsFiltrees"
          class="intervention-item-compact"
          (click)="voirDetails(intervention.id)">
          <span class="priority-dot" [style.background-color]="getPrioriteColor(intervention.priorite)"></span>
          <span class="intervention-id">#{{ intervention.id }}</span>
          <span class="intervention-desc">{{ intervention.description || 'Sans description' }}</span>
          <span class="intervention-priority">{{ getPrioriteLabel(intervention.priorite) }}</span>
          <button *ngIf="intervention.etat === 'EN_ATTENTE'"
            (click)="confirmerReception(intervention.id)"
            class="btn-small">
        âœ… Confirmer la rÃ©ception
    </button>

    <button *ngIf="intervention.etat === 'EN_COURS'"
            (click)="voirDetails(intervention.id)"
            class="btn-small">
        ğŸ”§ Commencer les tÃ¢ches
    </button>
        </div>
        <div *ngIf="interventionsFiltrees.length === 0" class="no-interventions">
          Aucune intervention pour cette date
        </div>
      </div>
    </div>
  </div>

  <!-- CONTENT GRID -->
  <div class="content-grid" *ngIf="viewMode === 'list'">
    <!-- LEFT COLUMN: FILTRES ET RECHERCHE -->
    <div class="filters-section">
      <div class="card">
        <div class="card-header">
          <h2>ğŸ” Recherche et Filtres</h2>
          <span class="results-count" *ngIf="interventionsFiltrees.length > 0">
            {{ interventionsFiltrees.length }} rÃ©sultat(s)
          </span>
        </div>
        <div class="card-body">
          <div class="filters-grid">
            <div class="search-wrapper">
              <input
                type="text"
                [(ngModel)]="recherche"
                (input)="appliquerFiltres()"
                placeholder="Rechercher par description, ID, type..."
                class="search-input"
                [attr.aria-label]="'Rechercher une intervention'">
              <span class="search-icon">ğŸ”</span>
            </div>

            <select
              [(ngModel)]="filtreEtat"
              (change)="loadMyInterventions()"
              class="filter-select"
              [attr.aria-label]="'Filtrer par Ã©tat'">
              <option value="">Tous les Ã©tats</option>
              <option value="EN_ATTENTE">â³ En Attente</option>
              <option value="EN_COURS">ğŸ”§ En Cours</option>
              <option value="SUSPENDUE">â¸ï¸ Suspendue</option>
              <option value="TERMINEE">âœ… TerminÃ©e</option>
              <option value="REPORTEE">ğŸ“… ReportÃ©e</option>
            </select>

            <select
              [(ngModel)]="filtrePriorite"
              (change)="loadMyInterventions()"
              class="filter-select"
              [attr.aria-label]="'Filtrer par prioritÃ©'">
              <option value="">Toutes les prioritÃ©s</option>
              <option value="URGENTE">ğŸ”´ Urgente</option>
              <option value="CRITIQUE">ğŸ”´ Critique</option>
              <option value="HAUTE">ğŸŸ  Haute</option>
              <option value="MOYENNE">ğŸŸ¡ Moyenne</option>
              <option value="PLANIFIEE">ğŸŸ¡ PlanifiÃ©e</option>
              <option value="BASSE">âšª Basse</option>
            </select>
          </div>
        </div>
      </div>

      <!-- ACTIONS RAPIDES -->
      <div class="card">
        <div class="card-header">
          <h2>âš¡ Actions Rapides</h2>
        </div>
        <div class="card-body">
          <div class="action-grid">
            <button class="action-btn" [routerLink]="['/technicien/interventions']">
              <span class="action-icon">ğŸ“‹</span>
              <span class="action-label">Mes interventions</span>
            </button>
            <button class="action-btn" [routerLink]="['/technicien/interventions/en-cours']">
              <span class="action-icon">ğŸŸ¢</span>
              <span class="action-label">En cours</span>
            </button>
            <button class="action-btn" [routerLink]="['/technicien/main-doeuvre']">
              <span class="action-icon">ğŸ‘·</span>
              <span class="action-label">Main d'Å“uvre</span>
            </button>
            <button class="action-btn" [routerLink]="['/technicien/profil']">
              <span class="action-icon">ğŸ‘¤</span>
              <span class="action-label">Mon profil</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN: LISTE DES INTERVENTIONS -->
    <div class="interventions-section">
      <div class="card">
        <div class="card-header">
          <h2>ğŸ“‹ Mes Interventions</h2>
          <a [routerLink]="['/technicien/interventions']" class="view-all">Voir tout â†’</a>
        </div>
        <div class="card-body">
          <!-- Dans technicien-dashboard.component.html -->
<!-- MODIFIER LA SECTION DES INTERVENTIONS -->

<div class="interventions-container-list">
  <div
    *ngFor="let intervention of interventionsFiltrees.slice(0, 5); trackBy: trackByInterventionId"
    class="list-item"
    (click)="voirDetails(intervention.id)">
    <div class="item-icon">ğŸ”§</div>
    <div class="item-content">
      <div class="item-title">#{{ intervention.id }} - {{ (intervention.description || 'Sans description') | slice:0:40 }}{{ (intervention.description && intervention.description.length > 40) ? '...' : '' }}</div>
      <div class="item-meta">
        <span class="badge" [ngClass]="getBadgeClass(intervention.etat)">{{ getEtatLabel(intervention.etat) }}</span>
        <span class="item-date">{{ intervention.datePlanifiee | date:'dd/MM/yyyy' }}</span>
        <span class="item-priority" [style.color]="getPrioriteColor(intervention.priorite)">{{ getPrioriteLabel(intervention.priorite) }}</span>
      </div>
    </div>

    <!-- BOUTON POUR TERMINER L'INTERVENTION - Ã€ L'INTÃ‰RIEUR DE LA BOUCLE -->
    <button *ngIf="intervention.etat === 'EN_COURS' || intervention.etat === 'EN_ATTENTE'"
            (click)="verifierEtTerminerIntervention(intervention); $event.stopPropagation()"
            class="btn-small success"
            style="background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); color: white; margin: 3px;">
      âœ… Terminer Intervention
    </button>
  </div>

  <div *ngIf="interventionsFiltrees.length === 0 && !loading" class="list-empty">
    <div class="empty-icon">ğŸ“­</div>
    <p>Aucune intervention trouvÃ©e</p>
  </div>

  <div *ngIf="loading" class="list-empty">
    <div class="spinner-small"></div>
    <p>Chargement...</p>
  </div>
</div>
        </div>
      </div>
    </div>
    <!-- Dans technicien-dashboard.component.html -->
<!-- Ajouter un bouton dans la liste des interventions -->


  </div>

</div>
