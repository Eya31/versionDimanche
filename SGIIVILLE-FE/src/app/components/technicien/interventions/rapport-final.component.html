<div class="rapport-final" *ngIf="intervention">
  <header class="rapport-header">
    <h1>ğŸ“„ Rapport Final - Intervention #{{intervention.id}}</h1>
    <button class="btn-secondary" (click)="retour()">â† Retour</button>
  </header>

  <form class="rapport-form" (ngSubmit)="soumettreRapport()">
    <!-- RÃ©sultat obtenu -->
    <section class="form-section">
      <h2>âœ… RÃ©sultat Obtenu *</h2>
      <textarea [(ngModel)]="rapport.resultatObtenu" 
                name="resultatObtenu"
                required
                rows="5"
                placeholder="DÃ©crivez le rÃ©sultat de l'intervention..."></textarea>
    </section>

    <!-- Temps total -->
    <section class="form-section">
      <h2>â±ï¸ Temps Total RÃ©alisÃ©</h2>
      <input type="number" 
             [(ngModel)]="rapport.tempsTotalMinutes" 
             name="tempsTotalMinutes"
             placeholder="Temps en minutes"
             min="0">
    </section>

    <!-- Ressources utilisÃ©es -->
    <section class="form-section">
      <h2>ğŸ“¦ Ressources UtilisÃ©es</h2>
      <div class="add-resource">
        <input type="number" 
               [(ngModel)]="nouvelleRessource.ressourceId" 
               placeholder="ID Ressource">
        <input type="text" 
               [(ngModel)]="nouvelleRessource.type" 
               placeholder="Type">
        <input type="number" 
               [(ngModel)]="nouvelleRessource.quantite" 
               placeholder="QuantitÃ©"
               step="0.01">
        <input type="text" 
               [(ngModel)]="nouvelleRessource.reference" 
               placeholder="RÃ©fÃ©rence">
        <input type="text" 
               [(ngModel)]="nouvelleRessource.numeroLot" 
               placeholder="NÂ° Lot">
        <button type="button" class="btn-primary" (click)="ajouterRessource()">Ajouter</button>
      </div>
      <div class="resources-list">
        <div *ngFor="let res of rapport.ressourcesUtilisees; let i = index" class="resource-item">
          <div class="item-info">
            <strong>Type:</strong>
            <span>{{res.type}} - QuantitÃ©: {{res.quantite}} {{res.reference ? '- RÃ©f: ' + res.reference : ''}} {{res.numeroLot ? '- Lot: ' + res.numeroLot : ''}}</span>
          </div>
          <button type="button" class="btn-danger btn-small" (click)="supprimerRessource(i)">ğŸ—‘ï¸ Supprimer</button>
        </div>
        <div *ngIf="rapport.ressourcesUtilisees.length === 0" class="empty-state">
          <p>Aucune ressource ajoutÃ©e</p>
        </div>
      </div>
    </section>

    <!-- Ã‰quipements utilisÃ©s -->
    <section class="form-section">
      <h2>âš™ï¸ Ã‰quipements UtilisÃ©s</h2>
      <div class="add-equipement">
        <input type="number" 
               [(ngModel)]="nouvelEquipement.equipementId" 
               placeholder="ID Ã‰quipement">
        <input type="text" 
               [(ngModel)]="nouvelEquipement.type" 
               placeholder="Type">
        <input type="text" 
               [(ngModel)]="nouvelEquipement.reference" 
               placeholder="RÃ©fÃ©rence">
        <input type="number" 
               [(ngModel)]="nouvelEquipement.dureeUtilisationMinutes" 
               placeholder="DurÃ©e (min)">
        <button type="button" class="btn-primary" (click)="ajouterEquipement()">Ajouter</button>
      </div>
      <div class="equipements-list">
        <div *ngFor="let eq of rapport.equipementsUtilises; let i = index" class="equipement-item">
          <div class="item-info">
            <strong>Type:</strong>
            <span>{{eq.type}} - DurÃ©e: {{eq.dureeUtilisationMinutes}} min {{eq.reference ? '- RÃ©f: ' + eq.reference : ''}}</span>
          </div>
          <button type="button" class="btn-danger btn-small" (click)="supprimerEquipement(i)">ğŸ—‘ï¸ Supprimer</button>
        </div>
        <div *ngIf="rapport.equipementsUtilises.length === 0" class="empty-state">
          <p>Aucun Ã©quipement ajoutÃ©</p>
        </div>
      </div>
    </section>

    <!-- ProblÃ¨mes rencontrÃ©s -->
    <section class="form-section">
      <h2>âš ï¸ ProblÃ¨mes RencontrÃ©s</h2>
      <textarea [(ngModel)]="rapport.problemesRencontres" 
                name="problemesRencontres"
                rows="4"
                placeholder="DÃ©crivez les problÃ¨mes rencontrÃ©s..."></textarea>
    </section>

    <!-- Commentaire personnalisÃ© -->
    <section class="form-section">
      <h2>ğŸ’¬ Commentaire PersonnalisÃ©</h2>
      <p class="section-hint">Ce commentaire sera inclus dans le rapport PDF final</p>
      <textarea [(ngModel)]="rapport.commentairePersonnalise" 
                name="commentairePersonnalise"
                rows="4"
                placeholder="Ajoutez un commentaire ou une note personnalisÃ©e qui sera inclus dans le rapport..."></textarea>
    </section>

    <!-- Analyse et Recommandations (optionnel) -->
    <section class="form-section">
      <h2>ğŸ“Š Analyse et Recommandations (Optionnel)</h2>
      <p class="section-hint">Section dÃ©diÃ©e aux interventions critiques - Analyse technique et recommandations pour les futures interventions</p>
      <textarea [(ngModel)]="rapport.analyseEtRecommandations" 
                name="analyseEtRecommandations"
                rows="5"
                placeholder="Analyse technique, recommandations, retours d'expÃ©rience..."></textarea>
    </section>

    <!-- Photos -->
    <section class="form-section">
      <h2>ğŸ“¸ Preuves (Photos)</h2>
      <input type="file" 
             multiple 
             accept="image/*" 
             (change)="onFileSelected($event)">
      <p *ngIf="selectedFiles.length > 0">{{selectedFiles.length}} fichier(s) sÃ©lectionnÃ©(s)</p>
    </section>

    <!-- Signature -->
    <section class="form-section">
      <h2>âœï¸ Signature Ã‰lectronique</h2>
      <input type="text" 
             [(ngModel)]="rapport.signatureElectronique" 
             name="signatureElectronique"
             placeholder="Votre nom pour signature">
    </section>

    <!-- AperÃ§u des informations -->
    <section class="form-section preview-section">
      <h2>ğŸ“‹ AperÃ§u du Rapport</h2>
      <div class="preview-info">
        <div class="preview-item">
          <strong>Intervention:</strong>
          <span>#{{intervention.id}} - {{intervention.description || 'Sans description'}}</span>
        </div>
        <div class="preview-item">
          <strong>Nombre de tÃ¢ches:</strong>
          <span>{{taches.length}}</span>
        </div>
        <div class="preview-item">
          <strong>Ressources utilisÃ©es:</strong>
          <span>{{rapport.ressourcesUtilisees.length}}</span>
        </div>
        <div class="preview-item">
          <strong>Ã‰quipements utilisÃ©s:</strong>
          <span>{{rapport.equipementsUtilises.length}}</span>
        </div>
      </div>
      <button type="button" class="btn-generate-pdf" (click)="genererPDF()">
        ğŸ“„ GÃ©nÃ©rer le PDF
      </button>
    </section>

    <!-- Actions -->
    <div class="form-actions">
      <button type="button" class="btn-secondary" (click)="retour()">Annuler</button>
      <button type="button" class="btn-preview" (click)="genererPDF()">ğŸ“„ PrÃ©visualiser PDF</button>
      <button type="submit" class="btn-success">ğŸ’¾ Soumettre et ClÃ´turer</button>
    </div>
  </form>
</div>

