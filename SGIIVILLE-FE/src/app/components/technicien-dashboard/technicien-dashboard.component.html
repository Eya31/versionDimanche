<!-- ============================================
     DASHBOARD TECHNICIEN - DESIGN REFONDU
     ============================================ -->

<div class="technicien-dashboard">
  <!-- PAGE HEADER -->
  <div class="page-header">
    <div>
      <h1>ğŸ“Š Tableau de Bord</h1>
      <p class="page-subtitle">GÃ©rez vos interventions en temps rÃ©el</p>
    </div>
    <div class="header-actions">
      <button 
        class="btn-view-toggle" 
        (click)="toggleView()"
        [attr.aria-label]="'Basculer entre vue liste et calendrier'">
        <span *ngIf="viewMode === 'list'">ğŸ“… Vue Calendrier</span>
        <span *ngIf="viewMode === 'calendar'">ğŸ“‹ Vue Liste</span>
      </button>
      <button 
        class="btn-refresh" 
        (click)="actualiser()"
        [attr.aria-label]="'Actualiser'">
        ğŸ”„ Actualiser
      </button>
    </div>
  </div>

  <!-- STATS CARDS - HIÃ‰RARCHIE VISUELLE AMÃ‰LIORÃ‰E -->
  <div class="stats-cards-container">
    <div class="stat-card stat-en-attente" *ngIf="stats.enAttente > 0">
      <div class="stat-icon">â³</div>
      <div class="stat-content">
        <p class="stat-value">{{ stats.enAttente }}</p>
        <p class="stat-label">En Attente</p>
      </div>
      <div class="stat-trend">Nouvelles</div>
    </div>
    
    <div class="stat-card stat-en-cours" *ngIf="stats.enCours > 0">
      <div class="stat-icon">ğŸ”§</div>
      <div class="stat-content">
        <p class="stat-value">{{ stats.enCours }}</p>
        <p class="stat-label">En Cours</p>
      </div>
      <div class="stat-trend">Active</div>
    </div>
    
    <div class="stat-card stat-terminee" *ngIf="stats.terminees > 0">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <p class="stat-value">{{ stats.terminees }}</p>
        <p class="stat-label">TerminÃ©es</p>
      </div>
      <div class="stat-trend">ComplÃ©tÃ©es</div>
    </div>
    
    <div class="stat-card stat-suspendue" *ngIf="stats.suspendues > 0">
      <div class="stat-icon">â¸ï¸</div>
      <div class="stat-content">
        <p class="stat-value">{{ stats.suspendues }}</p>
        <p class="stat-label">Suspendues</p>
      </div>
      <div class="stat-trend">En pause</div>
    </div>
  </div>

  <!-- VUE CALENDRIER -->
  <div *ngIf="viewMode === 'calendar'" class="calendar-section">
    <app-mini-calendar
      [interventions]="interventions"
      [selectedDate]="selectedCalendarDate"
      (dateSelected)="onDateSelected($event)"
      (interventionClicked)="onInterventionClicked($event)">
    </app-mini-calendar>
    
    <!-- INTERVENTIONS DU JOUR SÃ‰LECTIONNÃ‰ -->
    <div *ngIf="selectedCalendarDate" class="selected-date-interventions">
      <h3>Interventions du {{ selectedCalendarDate | date:'dd/MM/yyyy' }}</h3>
      <div class="interventions-list-compact">
        <div 
          *ngFor="let intervention of interventionsFiltrees" 
          class="intervention-item-compact"
          (click)="voirDetails(intervention.id)">
          <span class="priority-dot" [style.background-color]="getPrioriteColor(intervention.priorite)"></span>
          <span class="intervention-id">#{{ intervention.id }}</span>
          <span class="intervention-desc">{{ intervention.description || 'Sans description' }}</span>
          <span class="intervention-priority">{{ getPrioriteLabel(intervention.priorite) }}</span>
        </div>
        <div *ngIf="interventionsFiltrees.length === 0" class="no-interventions">
          Aucune intervention pour cette date
        </div>
      </div>
    </div>
  </div>

  <!-- FILTRES ET RECHERCHE - DESIGN AMÃ‰LIORÃ‰ -->
  <div class="filters-section" *ngIf="viewMode === 'list'">
    <div class="section-title">
      <h2>ğŸ” Recherche et Filtres</h2>
      <span class="results-count" *ngIf="interventionsFiltrees.length > 0">
        {{ interventionsFiltrees.length }} rÃ©sultat(s)
      </span>
    </div>
    
    <div class="filters-grid">
      <div class="search-wrapper">
        <input 
          type="text" 
          [(ngModel)]="recherche" 
          (input)="appliquerFiltres()"
          placeholder="Rechercher par description, ID, type..."
          class="search-input"
          [attr.aria-label]="'Rechercher une intervention'">
        <span class="search-icon">ğŸ”</span>
      </div>
      
      <select 
        [(ngModel)]="filtreEtat" 
        (change)="loadMyInterventions()"
        class="filter-select"
        [attr.aria-label]="'Filtrer par Ã©tat'">
        <option value="">Tous les Ã©tats</option>
        <option value="EN_ATTENTE">â³ En Attente</option>
        <option value="EN_COURS">ğŸ”§ En Cours</option>
        <option value="SUSPENDUE">â¸ï¸ Suspendue</option>
        <option value="TERMINEE">âœ… TerminÃ©e</option>
        <option value="REPORTEE">ğŸ“… ReportÃ©e</option>
      </select>
      
      <select 
        [(ngModel)]="filtrePriorite" 
        (change)="loadMyInterventions()"
        class="filter-select"
        [attr.aria-label]="'Filtrer par prioritÃ©'">
        <option value="">Toutes les prioritÃ©s</option>
        <option value="URGENTE">ğŸ”´ Urgente</option>
        <option value="CRITIQUE">ğŸ”´ Critique</option>
        <option value="HAUTE">ğŸŸ  Haute</option>
        <option value="MOYENNE">ğŸŸ¡ Moyenne</option>
        <option value="PLANIFIEE">ğŸŸ¡ PlanifiÃ©e</option>
        <option value="BASSE">âšª Basse</option>
      </select>
    </div>
  </div>

  <!-- LISTE DES INTERVENTIONS - DESIGN AMÃ‰LIORÃ‰ -->
  <div class="interventions-container" *ngIf="viewMode === 'list'">
    <div 
      *ngFor="let intervention of interventionsFiltrees; trackBy: trackByInterventionId" 
      class="intervention-card"
      [class]="'priority-' + getPrioriteClass(intervention.priorite)">
      
      <!-- PRIORITY INDICATOR -->
      <div class="priority-indicator" [style.background-color]="getPrioriteColor(intervention.priorite)"></div>
      
      <!-- CARD HEADER -->
      <div class="card-header">
        <div class="card-title-section">
          <h3>Intervention #{{ intervention.id }}</h3>
          <p *ngIf="intervention.typeIntervention" class="card-subtitle">
            {{ intervention.typeIntervention }}
          </p>
        </div>
        <span class="badge" [class]="'badge-' + intervention.etat.toLowerCase().replace('_', '-')">
          {{ getEtatLabel(intervention.etat) }}
        </span>
      </div>

      <!-- CARD BODY -->
      <div class="card-body">
        <p *ngIf="intervention.description" class="description">
          {{ intervention.description }}
        </p>
        
        <div class="info-grid">
          <div class="info-item">
            <span class="info-icon">ğŸ¯</span>
            <div class="info-content">
              <span class="info-label">PrioritÃ©</span>
              <span class="info-value" [style.color]="getPrioriteColor(intervention.priorite)">
                {{ getPrioriteLabel(intervention.priorite) }}
              </span>
            </div>
          </div>
          
          <div class="info-item">
            <span class="info-icon">ğŸ“…</span>
            <div class="info-content">
              <span class="info-label">Date prÃ©vue</span>
              <span class="info-value">{{ intervention.datePlanifiee | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>
          
          <div class="info-item" *ngIf="intervention.dateDebut">
            <span class="info-icon">â°</span>
            <div class="info-content">
              <span class="info-label">DÃ©but</span>
              <span class="info-value">{{ intervention.dateDebut | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
          </div>
          
          <div class="info-item" *ngIf="intervention.tempsPasseMinutes">
            <span class="info-icon">â±ï¸</span>
            <div class="info-content">
              <span class="info-label">Temps passÃ©</span>
              <span class="info-value">{{ formatTemps(intervention.tempsPasseMinutes) }}</span>
            </div>
          </div>
          
          <div class="info-item">
            <span class="info-icon">ğŸ’°</span>
            <div class="info-content">
              <span class="info-label">Budget</span>
              <span class="info-value">{{ intervention.budget | number:'1.2-2' }} DT</span>
            </div>
          </div>

          <div class="info-item" *ngIf="intervention.mainDOeuvreIds && intervention.mainDOeuvreIds.length > 0">
            <span class="info-icon">ğŸ‘·</span>
            <div class="info-content">
              <span class="info-label">Main-d'Å“uvre</span>
              <span class="info-value">{{ intervention.mainDOeuvreIds.length }} personne(s)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- CARD ACTIONS -->
      <div class="card-actions">
        <button 
          class="btn-primary" 
          (click)="voirDetails(intervention.id)"
          [attr.aria-label]="'Voir les dÃ©tails de l\'intervention ' + intervention.id">
          <span>ğŸ“‹</span>
          <span>DÃ©tails</span>
        </button>
        
        <button 
          *ngIf="intervention.etat === 'EN_ATTENTE'" 
          class="btn-success" 
          (click)="confirmerReception(intervention.id)"
          [attr.aria-label]="'Confirmer la rÃ©ception de l\'intervention ' + intervention.id">
          <span>âœ“</span>
          <span>Confirmer</span>
        </button>
      </div>
    </div>
    
    <!-- EMPTY STATE -->
    <div *ngIf="interventionsFiltrees.length === 0 && !loading" class="empty-state">
      <div class="empty-icon">ğŸ“­</div>
      <h3>Aucune intervention trouvÃ©e</h3>
      <p>Modifiez vos filtres ou attendez de nouvelles assignations</p>
    </div>

    <!-- LOADING STATE -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Chargement des interventions...</p>
    </div>
  </div>
</div>
